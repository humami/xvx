[bits 32]
%define ERROR_CODE     nop
%define NO_ERROR_CODE  push 0

extern intr_handler

global idt_flush
idt_flush:
    mov eax, [esp + 4]
    lidt [eax]
    ret

%macro INTR_VECTOR 2
global intr%1
intr%1:
    %2
    push ds
    push es
    push fs
    push gs
    pushad

    mov al, 0x20
    out 0xa0, al
    out 0x20, al
    
    push %1
    call intr_handler
    
    add esp, 4
    popad
    pop gs
    pop fs
    pop es
    pop ds

    add esp, 4
    iret
%endmacro

INTR_VECTOR 0,  NO_ERROR_CODE
INTR_VECTOR 1,  NO_ERROR_CODE
INTR_VECTOR 2,  NO_ERROR_CODE
INTR_VECTOR 3,  NO_ERROR_CODE
INTR_VECTOR 4,  NO_ERROR_CODE
INTR_VECTOR 5,  NO_ERROR_CODE
INTR_VECTOR 6,  NO_ERROR_CODE
INTR_VECTOR 7,  NO_ERROR_CODE
INTR_VECTOR 8,  ERROR_CODE
INTR_VECTOR 9,  NO_ERROR_CODE
INTR_VECTOR 10, ERROR_CODE
INTR_VECTOR 11, ERROR_CODE
INTR_VECTOR 12, ERROR_CODE
INTR_VECTOR 13, ERROR_CODE
INTR_VECTOR 14, ERROR_CODE
INTR_VECTOR 15, NO_ERROR_CODE
INTR_VECTOR 16, NO_ERROR_CODE
INTR_VECTOR 17, ERROR_CODE
INTR_VECTOR 18, NO_ERROR_CODE
INTR_VECTOR 19, NO_ERROR_CODE

INTR_VECTOR 20, NO_ERROR_CODE
INTR_VECTOR 21, NO_ERROR_CODE
INTR_VECTOR 22, NO_ERROR_CODE
INTR_VECTOR 23, NO_ERROR_CODE
INTR_VECTOR 24, NO_ERROR_CODE
INTR_VECTOR 25, NO_ERROR_CODE
INTR_VECTOR 26, NO_ERROR_CODE
INTR_VECTOR 27, NO_ERROR_CODE
INTR_VECTOR 28, NO_ERROR_CODE
INTR_VECTOR 29, NO_ERROR_CODE
INTR_VECTOR 30, NO_ERROR_CODE
INTR_VECTOR 31, NO_ERROR_CODE

INTR_VECTOR 32, NO_ERROR_CODE
INTR_VECTOR 33, NO_ERROR_CODE
INTR_VECTOR 34, NO_ERROR_CODE
INTR_VECTOR 35, NO_ERROR_CODE
INTR_VECTOR 36, NO_ERROR_CODE
INTR_VECTOR 37, NO_ERROR_CODE
INTR_VECTOR 38, NO_ERROR_CODE
INTR_VECTOR 39, NO_ERROR_CODE
INTR_VECTOR 40, NO_ERROR_CODE
INTR_VECTOR 41, NO_ERROR_CODE
INTR_VECTOR 42, NO_ERROR_CODE
INTR_VECTOR 43, NO_ERROR_CODE
INTR_VECTOR 44, NO_ERROR_CODE
INTR_VECTOR 45, NO_ERROR_CODE
INTR_VECTOR 46, NO_ERROR_CODE
INTR_VECTOR 47, NO_ERROR_CODE

INTR_VECTOR 255, NO_ERROR_CODE
